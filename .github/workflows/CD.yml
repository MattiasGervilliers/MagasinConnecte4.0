name: MagasinConnecte4.0 CD

on:
  workflow_run:
    workflows: ["MagasinConnecte4.0 CI"]
    types:
      - completed
  
jobs:
  run_pull:
    if: ${{ github.event.workflow_run.conclusion == 'success' && github.event.workflow_run.head_branch == 'master' }}
    name: run pull
    runs-on: ubuntu-latest
    
    steps:
    - name: install ssh
      run: sudo apt-get update && sudo apt-get install -y sshpass
    - name: connect and pull
      run: sshpass -p '${{ secrets.SSH_PWD }}' ${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }} "cd ${{ secrets.WORK_DIR }} && git checkout ${{ secrets.MAIN_BRANCH }} && git pull && exit"
    - name: cleanup
      run: rm -rf ~/.ssh
